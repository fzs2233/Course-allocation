{"ast":null,"code":"import { ref, computed, onMounted } from 'vue';\nimport { useStore } from 'vuex';\nimport { ethers } from 'ethers';\nimport api from '../api';\n\n// 导入合约配置\nimport contractConfig from '../contractConfig';\nexport default {\n  name: 'HomeView',\n  setup() {\n    const store = useStore();\n    const connecting = ref(false);\n    const initializing = ref(false);\n    const initialized = ref(false);\n    const connectError = ref('');\n    const loadingCourseData = ref(false);\n    const loadingTeacherData = ref(false);\n    const courseData = ref([]);\n    const teacherData = ref([]);\n\n    // 获取教师列数（动态生成表头）\n    const getTeacherColumns = () => {\n      if (teacherData.value.length === 0) return [];\n\n      // 从第一个课程数据中提取教师数量\n      const firstCourse = teacherData.value[0];\n      const teacherCount = Object.keys(firstCourse).filter(key => key.includes('教师') && key.includes('suit')).length;\n      return Array(teacherCount).fill(0);\n    };\n\n    // 从Vuex获取状态\n    const account = computed(() => store.state.account);\n    const isConnected = computed(() => store.getters.isConnected);\n\n    // 连接MetaMask\n    const connectMetaMask = async () => {\n      connecting.value = true;\n      connectError.value = '';\n      try {\n        const account = await store.dispatch('connectWallet');\n        if (!account) {\n          connectError.value = '连接钱包失败，请确保已安装MetaMask并已登录';\n        }\n      } catch (error) {\n        console.error('连接钱包错误:', error);\n        connectError.value = '连接钱包时发生错误: ' + error.message;\n      } finally {\n        connecting.value = false;\n      }\n    };\n\n    // 初始化系统数据\n    const initializeData = async () => {\n      initializing.value = true;\n      try {\n        // 检查网络是否为Ganache (ID 1337)\n        const provider = new ethers.providers.Web3Provider(window.ethereum);\n        const network = await provider.getNetwork();\n        if (network.chainId !== 1337) {\n          alert('请连接到Ganache网络');\n          initializing.value = false;\n          return;\n        }\n\n        // 调用后端API初始化数据\n        const response = await api.initializeData();\n        console.log('初始化结果:', response);\n        if (response.code === 0) {\n          initialized.value = true;\n          store.commit('setInitialized', true);\n        } else {\n          alert('初始化失败: ' + response.message);\n        }\n      } catch (error) {\n        console.error('初始化系统数据错误:', error);\n        alert('初始化系统数据时发生错误: ' + error.message);\n      } finally {\n        initializing.value = false;\n      }\n    };\n\n    // 获取课程重要程度和智能体适合程度\n    const getCourseImportance = async () => {\n      loadingCourseData.value = true;\n      try {\n        const response = await api.getCourseImportance();\n        console.log('课程重要程度数据:', response);\n        if (response.code === 0) {\n          courseData.value = response.data;\n        } else {\n          alert('获取课程重要程度失败: ' + response.message);\n        }\n      } catch (error) {\n        console.error('获取课程重要程度错误:', error);\n        alert('获取课程重要程度时发生错误: ' + error.message);\n      } finally {\n        loadingCourseData.value = false;\n      }\n    };\n\n    // 获取教师对课程适合程度\n    const getTeacherSuitability = async () => {\n      loadingTeacherData.value = true;\n      try {\n        const response = await api.getTeacherSuitability();\n        console.log('教师对课程适合程度数据:', response);\n        if (response.code === 0) {\n          teacherData.value = response.data;\n        } else {\n          alert('获取教师对课程适合程度失败: ' + response.message);\n        }\n      } catch (error) {\n        console.error('获取教师对课程适合程度错误:', error);\n        alert('获取教师对课程适合程度时发生错误: ' + error.message);\n      } finally {\n        loadingTeacherData.value = false;\n      }\n    };\n\n    // 组件挂载时执行\n    onMounted(async () => {\n      // 如果已经有MetaMask连接，则自动连接\n      if (window.ethereum && window.ethereum.selectedAddress) {\n        await connectMetaMask();\n      }\n    });\n    return {\n      connectMetaMask,\n      initializeData,\n      getCourseImportance,\n      getTeacherSuitability,\n      getTeacherColumns,\n      courseData,\n      teacherData,\n      account,\n      isConnected,\n      connecting,\n      initializing,\n      initialized,\n      loadingCourseData,\n      loadingTeacherData,\n      connectError\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useStore","ethers","api","contractConfig","name","setup","store","connecting","initializing","initialized","connectError","loadingCourseData","loadingTeacherData","courseData","teacherData","getTeacherColumns","value","length","firstCourse","teacherCount","Object","keys","filter","key","includes","Array","fill","account","state","isConnected","getters","connectMetaMask","dispatch","error","console","message","initializeData","provider","providers","Web3Provider","window","ethereum","network","getNetwork","chainId","alert","response","log","code","commit","getCourseImportance","data","getTeacherSuitability","selectedAddress"],"sources":["E:\\dao\\327\\Course-allocation\\frontend\\src\\views\\Home.vue"],"sourcesContent":["<template>\n  <div class=\"home-container\">\n    <el-card class=\"box-card\">\n      <template #header>\n        <div class=\"card-header\">\n          <h1>课程分配系统</h1>\n        </div>\n      </template>\n      <div v-if=\"!isConnected\" class=\"connect-section\">\n        <el-alert\n          v-if=\"connectError\"\n          :title=\"connectError\"\n          type=\"error\"\n          show-icon\n          :closable=\"false\"\n          style=\"margin-bottom: 20px;\"\n        />\n        <el-button type=\"primary\" @click=\"connectMetaMask\" :loading=\"connecting\">\n          连接 MetaMask 钱包\n        </el-button>\n      </div>\n      <div v-else class=\"init-section\">\n        <p>当前钱包地址: {{ account }}</p>\n        <div class=\"action-buttons\">\n          <el-button \n            type=\"success\" \n            @click=\"initializeData\"\n            :loading=\"initializing\"\n            :disabled=\"initialized\"\n          >\n            一键初始化系统数据\n          </el-button>\n          <el-button type=\"info\" @click=\"$router.push('/about')\">关于系统</el-button>\n          \n          <!-- 添加查看课程重要程度和智能体适合程度的按钮 -->\n          <el-button \n            type=\"primary\" \n            @click=\"getCourseImportance\"\n            :loading=\"loadingCourseData\"\n            :disabled=\"!initialized\"\n          >\n            查看课程重要程度\n          </el-button>\n          \n          <!-- 添加查看教师对课程适合程度的按钮 -->\n          <el-button \n            type=\"warning\" \n            @click=\"getTeacherSuitability\"\n            :loading=\"loadingTeacherData\"\n            :disabled=\"!initialized\"\n          >\n            查看教师适合程度\n          </el-button>\n        </div>\n        <el-result \n          v-if=\"initialized\" \n          icon=\"success\" \n          title=\"初始化成功\" \n          sub-title=\"系统数据已成功初始化，可以开始使用系统功能\"\n        />\n        \n        <!-- 课程重要程度和智能体适合程度数据表格 -->\n        <div v-if=\"courseData.length > 0\" class=\"data-table-container\">\n          <h2>课程重要程度和智能体适合程度</h2>\n          <el-table :data=\"courseData\" border style=\"width: 100%\">\n            <el-table-column prop=\"课程ID\" label=\"课程ID\" width=\"100\" />\n            <el-table-column prop=\"重要程度\" label=\"重要程度\" width=\"120\" />\n            <el-table-column prop=\"智能体1对课程的适合程度\" label=\"智能体1适合程度\" />\n            <el-table-column prop=\"智能体2对课程的适合程度\" label=\"智能体2适合程度\" />\n          </el-table>\n        </div>\n        \n        <!-- 教师对课程适合程度数据表格 -->\n        <div v-if=\"teacherData.length > 0\" class=\"data-table-container\">\n          <h2>教师对课程适合程度</h2>\n          <el-table :data=\"teacherData\" border style=\"width: 100%\">\n            <el-table-column prop=\"课程ID\" label=\"课程ID\" width=\"80\" />\n            <el-table-column prop=\"课程名称\" label=\"课程名称\" width=\"200\" />\n            <el-table-column \n              v-for=\"(_, index) in getTeacherColumns()\" \n              :key=\"index\"\n              :prop=\"'教师' + (index + 1) + ' suit'\"\n              :label=\"'教师' + (index + 1)\"\n            />\n          </el-table>\n        </div>\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted } from 'vue'\nimport { useStore } from 'vuex'\nimport { ethers } from 'ethers'\nimport api from '../api'\n\n// 导入合约配置\nimport contractConfig from '../contractConfig'\n\nexport default {\n  name: 'HomeView',\n  setup() {\n    const store = useStore()\n    const connecting = ref(false)\n    const initializing = ref(false)\n    const initialized = ref(false)\n    const connectError = ref('')\n    const loadingCourseData = ref(false)\n    const loadingTeacherData = ref(false)\n    const courseData = ref([])\n    const teacherData = ref([])\n\n    // 获取教师列数（动态生成表头）\n    const getTeacherColumns = () => {\n      if (teacherData.value.length === 0) return []\n      \n      // 从第一个课程数据中提取教师数量\n      const firstCourse = teacherData.value[0]\n      const teacherCount = Object.keys(firstCourse).filter(key => key.includes('教师') && key.includes('suit')).length\n      \n      return Array(teacherCount).fill(0)\n    }\n\n    // 从Vuex获取状态\n    const account = computed(() => store.state.account)\n    const isConnected = computed(() => store.getters.isConnected)\n\n    // 连接MetaMask\n    const connectMetaMask = async () => {\n      connecting.value = true\n      connectError.value = ''\n      \n      try {\n        const account = await store.dispatch('connectWallet')\n        if (!account) {\n          connectError.value = '连接钱包失败，请确保已安装MetaMask并已登录'\n        }\n      } catch (error) {\n        console.error('连接钱包错误:', error)\n        connectError.value = '连接钱包时发生错误: ' + error.message\n      } finally {\n        connecting.value = false\n      }\n    }\n\n    // 初始化系统数据\n    const initializeData = async () => {\n      initializing.value = true\n      try {\n        // 检查网络是否为Ganache (ID 1337)\n        const provider = new ethers.providers.Web3Provider(window.ethereum)\n        const network = await provider.getNetwork()\n        \n        if (network.chainId !== 1337) {\n          alert('请连接到Ganache网络')\n          initializing.value = false\n          return\n        }\n\n        // 调用后端API初始化数据\n        const response = await api.initializeData()\n        console.log('初始化结果:', response)\n        \n        if (response.code === 0) {\n          initialized.value = true\n          store.commit('setInitialized', true)\n        } else {\n          alert('初始化失败: ' + response.message)\n        }\n      } catch (error) {\n        console.error('初始化系统数据错误:', error)\n        alert('初始化系统数据时发生错误: ' + error.message)\n      } finally {\n        initializing.value = false\n      }\n    }\n    \n    // 获取课程重要程度和智能体适合程度\n    const getCourseImportance = async () => {\n      loadingCourseData.value = true\n      try {\n        const response = await api.getCourseImportance()\n        console.log('课程重要程度数据:', response)\n        \n        if (response.code === 0) {\n          courseData.value = response.data\n        } else {\n          alert('获取课程重要程度失败: ' + response.message)\n        }\n      } catch (error) {\n        console.error('获取课程重要程度错误:', error)\n        alert('获取课程重要程度时发生错误: ' + error.message)\n      } finally {\n        loadingCourseData.value = false\n      }\n    }\n    \n    // 获取教师对课程适合程度\n    const getTeacherSuitability = async () => {\n      loadingTeacherData.value = true\n      try {\n        const response = await api.getTeacherSuitability()\n        console.log('教师对课程适合程度数据:', response)\n        \n        if (response.code === 0) {\n          teacherData.value = response.data\n        } else {\n          alert('获取教师对课程适合程度失败: ' + response.message)\n        }\n      } catch (error) {\n        console.error('获取教师对课程适合程度错误:', error)\n        alert('获取教师对课程适合程度时发生错误: ' + error.message)\n      } finally {\n        loadingTeacherData.value = false\n      }\n    }\n\n    // 组件挂载时执行\n    onMounted(async () => {\n      // 如果已经有MetaMask连接，则自动连接\n      if (window.ethereum && window.ethereum.selectedAddress) {\n        await connectMetaMask()\n      }\n    })\n\n    return {\n      connectMetaMask,\n      initializeData,\n      getCourseImportance,\n      getTeacherSuitability,\n      getTeacherColumns,\n      courseData,\n      teacherData,\n      account,\n      isConnected,\n      connecting,\n      initializing,\n      initialized,\n      loadingCourseData,\n      loadingTeacherData,\n      connectError\n    }\n  }\n}\n</script>\n\n<style scoped>\n.home-container {\n  max-width: 800px;\n  margin: 50px auto;\n  padding: 0 20px;\n}\n\n.card-header {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.connect-section, .init-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 20px;\n  padding: 20px 0;\n}\n\n.action-buttons {\n  display: flex;\n  gap: 15px;\n  margin: 20px 0;\n}\n\n.data-table-container {\n  margin-top: 30px;\n  width: 100%;\n}\n\n.data-table-container h2 {\n  margin-bottom: 15px;\n  text-align: center;\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
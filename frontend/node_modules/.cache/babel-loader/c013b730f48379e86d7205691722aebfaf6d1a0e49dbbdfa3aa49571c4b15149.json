{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, createVNode as _createVNode, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString } from \"vue\";\nconst _hoisted_1 = {\n  class: \"home-container\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"connect-section\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"init-section\"\n};\nconst _hoisted_4 = {\n  class: \"action-buttons\"\n};\nconst _hoisted_5 = {\n  key: 1,\n  class: \"importance-table-section\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_alert = _resolveComponent(\"el-alert\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_result = _resolveComponent(\"el-result\");\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n  const _component_el_table = _resolveComponent(\"el-table\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_card, {\n    class: \"box-card\"\n  }, {\n    header: _withCtx(() => _cache[2] || (_cache[2] = [_createElementVNode(\"div\", {\n      class: \"card-header\"\n    }, [_createElementVNode(\"h1\", null, \"课程分配系统\")], -1 /* HOISTED */)])),\n    default: _withCtx(() => [!$setup.isConnected ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [$setup.connectError ? (_openBlock(), _createBlock(_component_el_alert, {\n      key: 0,\n      title: $setup.connectError,\n      type: \"error\",\n      \"show-icon\": \"\",\n      closable: false,\n      style: {\n        \"margin-bottom\": \"20px\"\n      }\n    }, null, 8 /* PROPS */, [\"title\"])) : _createCommentVNode(\"v-if\", true), _createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: $setup.connectMetaMask,\n      loading: $setup.connecting\n    }, {\n      default: _withCtx(() => _cache[3] || (_cache[3] = [_createTextVNode(\" 连接 MetaMask 钱包 \")])),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"onClick\", \"loading\"])])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createElementVNode(\"p\", null, \"当前钱包地址: \" + _toDisplayString($setup.account), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_el_button, {\n      type: \"success\",\n      onClick: $setup.initializeData,\n      loading: $setup.initializing,\n      disabled: $setup.initialized\n    }, {\n      default: _withCtx(() => _cache[4] || (_cache[4] = [_createTextVNode(\" 一键初始化系统数据 \")])),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"onClick\", \"loading\", \"disabled\"]), _createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: $setup.getCourseImportance,\n      loading: $setup.loadingImportance,\n      disabled: !$setup.initialized\n    }, {\n      default: _withCtx(() => _cache[5] || (_cache[5] = [_createTextVNode(\" 查看课程重要程度 \")])),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"onClick\", \"loading\", \"disabled\"]), _createVNode(_component_el_button, {\n      type: \"info\",\n      onClick: _cache[0] || (_cache[0] = $event => _ctx.$router.push('/about'))\n    }, {\n      default: _withCtx(() => _cache[6] || (_cache[6] = [_createTextVNode(\"关于系统\")])),\n      _: 1 /* STABLE */\n    })]), $setup.initialized && !$setup.showImportanceTable ? (_openBlock(), _createBlock(_component_el_result, {\n      key: 0,\n      icon: \"success\",\n      title: \"初始化成功\",\n      \"sub-title\": \"系统数据已成功初始化，可以开始使用系统功能\"\n    })) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 课程重要程度表格 \"), $setup.showImportanceTable ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_cache[8] || (_cache[8] = _createElementVNode(\"h2\", null, \"课程重要程度与智能体适合度\", -1 /* HOISTED */)), _createVNode(_component_el_table, {\n      data: $setup.importanceData,\n      border: \"\",\n      stripe: \"\",\n      style: {\n        \"width\": \"100%\"\n      }\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_table_column, {\n        prop: \"courseId\",\n        label: \"课程ID\",\n        width: \"120\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"courseName\",\n        label: \"课程名称\",\n        width: \"180\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"importance\",\n        label: \"重要程度\",\n        width: \"120\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"agentSuit1\",\n        label: \"智能体1对课程的适合程度\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"agentSuit2\",\n        label: \"智能体2对课程的适合程度\"\n      })]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"data\"]), _createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: _cache[1] || (_cache[1] = $event => $setup.showImportanceTable = false),\n      style: {\n        \"margin-top\": \"20px\"\n      }\n    }, {\n      default: _withCtx(() => _cache[7] || (_cache[7] = [_createTextVNode(\" 隐藏表格 \")])),\n      _: 1 /* STABLE */\n    })])) : _createCommentVNode(\"v-if\", true)]))]),\n    _: 1 /* STABLE */\n  })]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createVNode","_component_el_card","header","_withCtx","_cache","_createElementVNode","default","$setup","isConnected","_hoisted_2","connectError","_createBlock","_component_el_alert","title","type","closable","style","_createCommentVNode","_component_el_button","onClick","connectMetaMask","loading","connecting","_createTextVNode","_","_hoisted_3","_toDisplayString","account","_hoisted_4","initializeData","initializing","disabled","initialized","getCourseImportance","loadingImportance","$event","_ctx","$router","push","showImportanceTable","_component_el_result","icon","_hoisted_5","_component_el_table","data","importanceData","border","stripe","_component_el_table_column","prop","label","width"],"sources":["E:\\dao\\327\\Course-allocation\\frontend\\src\\views\\Home.vue"],"sourcesContent":["<template>\r\n  <div class=\"home-container\">\r\n    <el-card class=\"box-card\">\r\n      <template #header>\r\n        <div class=\"card-header\">\r\n          <h1>课程分配系统</h1>\r\n        </div>\r\n      </template>\r\n      <div v-if=\"!isConnected\" class=\"connect-section\">\r\n        <el-alert\r\n          v-if=\"connectError\"\r\n          :title=\"connectError\"\r\n          type=\"error\"\r\n          show-icon\r\n          :closable=\"false\"\r\n          style=\"margin-bottom: 20px;\"\r\n        />\r\n        <el-button type=\"primary\" @click=\"connectMetaMask\" :loading=\"connecting\">\r\n          连接 MetaMask 钱包\r\n        </el-button>\r\n      </div>\r\n      <div v-else class=\"init-section\">\r\n        <p>当前钱包地址: {{ account }}</p>\r\n        <div class=\"action-buttons\">\r\n          <el-button \r\n            type=\"success\" \r\n            @click=\"initializeData\"\r\n            :loading=\"initializing\"\r\n            :disabled=\"initialized\"\r\n          >\r\n            一键初始化系统数据\r\n          </el-button>\r\n          <el-button \r\n            type=\"primary\" \r\n            @click=\"getCourseImportance\"\r\n            :loading=\"loadingImportance\"\r\n            :disabled=\"!initialized\"\r\n          >\r\n            查看课程重要程度\r\n          </el-button>\r\n          <el-button type=\"info\" @click=\"$router.push('/about')\">关于系统</el-button>\r\n        </div>\r\n        <el-result \r\n          v-if=\"initialized && !showImportanceTable\" \r\n          icon=\"success\" \r\n          title=\"初始化成功\" \r\n          sub-title=\"系统数据已成功初始化，可以开始使用系统功能\"\r\n        />\r\n        \r\n        <!-- 课程重要程度表格 -->\r\n        <div v-if=\"showImportanceTable\" class=\"importance-table-section\">\r\n          <h2>课程重要程度与智能体适合度</h2>\r\n          <el-table :data=\"importanceData\" border stripe style=\"width: 100%\">\r\n            <el-table-column prop=\"courseId\" label=\"课程ID\" width=\"120\" />\r\n            <el-table-column prop=\"courseName\" label=\"课程名称\" width=\"180\" />\r\n            <el-table-column prop=\"importance\" label=\"重要程度\" width=\"120\" />\r\n            <el-table-column prop=\"agentSuit1\" label=\"智能体1对课程的适合程度\" />\r\n            <el-table-column prop=\"agentSuit2\" label=\"智能体2对课程的适合程度\" />\r\n          </el-table>\r\n          <el-button \r\n            type=\"primary\" \r\n            @click=\"showImportanceTable = false\"\r\n            style=\"margin-top: 20px;\"\r\n          >\r\n            隐藏表格\r\n          </el-button>\r\n        </div>\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport { ethers } from 'ethers'\r\nimport api from '../api'\r\n\r\n// 导入合约配置\r\nimport contractConfig from '../contractConfig'\r\n\r\nexport default {\r\n  name: 'HomeView',\r\n  setup() {\r\n    const store = useStore()\r\n    const connecting = ref(false)\r\n    const initializing = ref(false)\r\n    const initialized = ref(false)\r\n    const connectError = ref('')\r\n    \r\n    // 课程重要程度相关数据\r\n    const loadingImportance = ref(false)\r\n    const importanceData = ref([])\r\n    const showImportanceTable = ref(false)\r\n\r\n    // 从Vuex获取状态\r\n    const account = computed(() => store.state.account)\r\n    const isConnected = computed(() => store.getters.isConnected)\r\n\r\n    // 连接MetaMask\r\n    const connectMetaMask = async () => {\r\n      connecting.value = true\r\n      connectError.value = ''\r\n      \r\n      try {\r\n        const account = await store.dispatch('connectWallet')\r\n        if (!account) {\r\n          connectError.value = '连接钱包失败，请确保已安装MetaMask并已登录'\r\n        }\r\n      } catch (error) {\r\n        console.error('连接钱包错误:', error)\r\n        connectError.value = '连接钱包时发生错误: ' + error.message\r\n      } finally {\r\n        connecting.value = false\r\n      }\r\n    }\r\n\r\n    // 初始化系统数据\r\n    const initializeData = async () => {\r\n      initializing.value = true\r\n      try {\r\n        // 检查网络是否为Ganache (ID 1337)\r\n        const provider = new ethers.providers.Web3Provider(window.ethereum)\r\n        const network = await provider.getNetwork()\r\n        \r\n        if (network.chainId !== 1337) {\r\n          alert('请连接到Ganache网络')\r\n          initializing.value = false\r\n          return\r\n        }\r\n\r\n        // 调用后端API初始化数据\r\n        const response = await api.initializeData()\r\n        console.log('初始化结果:', response)\r\n        \r\n        if (response.code === 0) {\r\n          initialized.value = true\r\n          store.commit('setInitialized', true)\r\n        } else {\r\n          alert('初始化失败: ' + response.message)\r\n        }\r\n      } catch (error) {\r\n        console.error('初始化系统数据错误:', error)\r\n        alert('初始化系统数据时发生错误: ' + error.message)\r\n      } finally {\r\n        initializing.value = false\r\n      }\r\n    }\r\n    \r\n    // 获取课程重要程度数据\r\n    const getCourseImportance = async () => {\r\n      loadingImportance.value = true\r\n      try {\r\n        const response = await api.getCourseImportance()\r\n        console.log('课程重要程度数据:', response)\r\n        \r\n        if (response.code === 0) {\r\n          importanceData.value = response.data\r\n          showImportanceTable.value = true\r\n        } else {\r\n          alert('获取课程重要程度失败: ' + response.message)\r\n        }\r\n      } catch (error) {\r\n        console.error('获取课程重要程度错误:', error)\r\n        alert('获取课程重要程度时发生错误: ' + error.message)\r\n      } finally {\r\n        loadingImportance.value = false\r\n      }\r\n    }\r\n\r\n    // 组件挂载时执行\r\n    onMounted(async () => {\r\n      // 如果已经有MetaMask连接，则自动连接\r\n      if (window.ethereum && window.ethereum.selectedAddress) {\r\n        await connectMetaMask()\r\n      }\r\n    })\r\n\r\n    return {\r\n      connectMetaMask,\r\n      initializeData,\r\n      getCourseImportance,\r\n      account,\r\n      isConnected,\r\n      connecting,\r\n      initializing,\r\n      initialized,\r\n      connectError,\r\n      loadingImportance,\r\n      importanceData,\r\n      showImportanceTable\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.home-container {\r\n  max-width: 800px;\r\n  margin: 50px auto;\r\n  padding: 0 20px;\r\n}\r\n\r\n.card-header {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.connect-section, .init-section {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 20px;\r\n  padding: 20px 0;\r\n}\r\n\r\n.action-buttons {\r\n  display: flex;\r\n  gap: 15px;\r\n  margin: 20px 0;\r\n}\r\n\r\n.importance-table-section {\r\n  width: 100%;\r\n  margin-top: 20px;\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}